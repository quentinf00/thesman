\section{\textit{Sea Surface Height Edition}}\label{sec:interp_challenge}
The \texttt{OceanBench} project is currently a first iteration dedicated to SSH interpolation.

The previous chapter highlighted the potential of learning-based methodologies for this task. Integrating and extending the corresponding experimental setups in \texttt{OceanBench} is a natural first step.

% Due to the irregular sampling delivered by satellite altimeter, state-of-the-art operational methods using optimal interpolation schemes~\cite{DUACS, MIOST} or model-driven data assimilation~\cite{DINEOF, DINEOF2, ANALOGDA, ANALOGDA2} fail to fully retrieve SSH dynamics at fine scales below 100-200km on a global or regional scale, so improving the space-time resolution of SSH fields has been a critical challenge in ocean science. 
% Beyond some technological developments~\cite{SWOT}, recent studies support the critical role of ML-based schemes in overcoming the current limitations of the operational systems~\cite{4DVARNETSWOT, BFNQG, SSHInterpAttention} .  
% Sea surface height (SSH) is one of the most critical, observable quantities when determining the ocean state. 
% It is widely used to study ocean dynamics and the adverse impact on global climate and human activities~\cite{SSHMESOSCALE}. 
% SSH enables us to track phenomena such as currents and eddies~\cite{SSHMESOSCALE,SSHMESOSCALE2,SSHMESOSCALE3}, which leads to a better quantification of the transport of energy, heat, and salt. 
% In addition, SSH helps us quantify sea level rise at regional and global scales~\cite{SSHSEALEVEL,OCEANSEALEVEL}, which is used for operational monitoring of the marine environment~\cite{SSHOPERATIONAL}. 
% Furthermore, SSH characterization provides a plethora of data products that downstream tasks can use for many other applications~\cite{SSH3DCIRCULATION, 3DQGOC}.
% %
% Due to the irregular sampling delivered by satellite altimeter, state-of-the-art operational methods using optimal interpolation schemes~\cite{DUACS, MIOST} or model-driven data assimilation~\cite{DINEOF, DINEOF2, ANALOGDA, ANALOGDA2} fail to fully retrieve SSH dynamics at fine scales below 100-200km on a global or regional scale, so improving the space-time resolution of SSH fields has been a critical challenge in ocean science. 
% Beyond some technological developments~\cite{SWOT}, recent studies support the critical role of ML-based schemes in overcoming the current limitations of the operational systems~\cite{4DVARNETSWOT, BFNQG, SSHInterpAttention} .  
% %
The rest of this section details some experimental designs and datasets. It also demonstrate the generation of metrics and plots by the \texttt{OceanBench} platform. 



% \subsection*{Problem Definition}\label{sec:prob_definition}

% we are dealing with satellite observations, so we are interested in the domain across the earth's surface. 
% let us de the earth's efindomain by some spatial coordinates, $\mathbf{x} = [\text{longitude},\text{latitude}]^\top \in\mathbb{r}^{d_s}$, and temporal coordinates, $t=[\text{time}]\in\mathbb{r}^+$, where $d_s$ is the dimensionality of the coordinate vector.  
% we can define some spatial (sub-)domain, $\omega\subseteq\mathbb{r}^{d_s}$, and a temporal (sub-)domain, $\mathcal{t}\subseteq\mathbb{r}^+$. 
% this domain could be the entire globe for 10 years or a small region within the north atlantic for 1 year.
% \begin{align}  \label{eq:spatiotemporal_coords}
%     \text{spatial coordinates}: && \mathbf{x} &\in \omega \subseteq \mathbb{r}^{d_s}\\ 
%     \text{temporal coordinates}: && t &\in \mathcal{t} \subseteq \mathbb{r}^+.
% \end{align}
% in this case $d_s=2$ because we only have a two coordinates, however we can do some coordinate transformations like spherical to cartesian. likewise, we can do some coordinate transformation for the temporal coordinates like cyclic transformations or sinusoidal embeddings~\cite{attention}. we have two fields of interest from these spatiotemporal coordinates: the state and the observations.
% \begin{align} \label{eq:state_obs}
%     \text{state}: && \boldsymbol{u}(\mathbf{x},t) &: \omega\times\mathcal{t}\rightarrow\mathbb{r}^{d_u} \\
%     \text{observations}: && \boldsymbol{y}_{obs}(\mathbf{x},t) &: \omega\times\mathcal{t}\rightarrow\mathbb{r}^{d_{obs}}
% \end{align}
% The state domain, $u\in\mathcal{U}$, is a scalar or vector-valued field of size $D_u$ which is typically the quantity of interest and the observation domain, $y_{obs}\in\mathcal{Y}_{obs}$, is the observable quantity which is also a scalar or vector-valued field of size $D_{obs}$. Now, we make the assumption that we have an operator $\mathcal{H}$ that transforms the field from the state space, $\boldsymbol{u}$, to the observation space, $\boldsymbol{y}_{obs}$.
% \begin{align} \label{eq:prob_definition}
%     \boldsymbol{y}_{obs}(\mathbf{x},t) = \mathcal{H}\left(\boldsymbol{u}(\mathbf{x},t), t, \boldsymbol{\varepsilon}, \boldsymbol{\mu}\right) 
% \end{align}
% This equation is the continuous function defined over the entire spatiotemporal domain.  
% The operator, $\mathcal{H}(\cdot)$, is flexible and problem dependent.
% For example, in a some discretized setting there are 0's wherever there are no observations, and 1's wherever there are observations, and in other discretized settings it takes a weighted average of the neighboring pixels.
% We also include a generic noise function, $\boldsymbol{\varepsilon}(\mathbf{x},t)$.
% This could stem from a distribution, it could stationary noise operator, $\boldsymbol{\varepsilon}(\mathbf{x})$, or it could be constant in space but vary with Time, $\boldsymbol{\varepsilon}(t)$. 
% We also include a control parameter, $\boldsymbol{\mu}$, representing any external factors or latent variables that could connect the state vector to the observation vector, e.g., sea surface temperature.
% %
% %###########################################################################################
% %
% % CAN BE FRAMED AS INVERSE PROBLEMS
% %
% Our quantity of interest is SSH, $\eta$, a scalar-valued field defined everywhere on the domain. In our application, we assume that the SSH we observe from satellite altimeters, $\eta_{obs}$, is the same as the SSH state, except it could be missing for some coordinates due to incomplete coverage from the satellite. So our transformation is defined as follows:
% \begin{align} \label{eq:ssh_field_continuous}
% \boldsymbol{\eta}_{obs}(\mathbf{x},t) &= \mathcal{H}\left(\boldsymbol{\eta}(\mathbf{x},t), t, \boldsymbol{\varepsilon}, \boldsymbol{\mu}\right)
% % , \hspace{10mm}
% % \mathbf{x} \in \Omega \subseteq \mathbb{R}^{D_s}, \hspace{10mm} 
% % t \in \mathcal{T} \subseteq \mathbb{R}^+.
% \end{align}
% In practice, the satellite providers have a reasonable estimation of the amount of structured noise level we can expect from the satellite altimetry data; however, unresolved noise could still be present. 
% % Although we do not explicitly specify the control parameter, $\boldsymbol{\mu}$, we leave it into the equation to account for any other state parameters not accounted for in our model. 
% Finally, we are interested in finding some model, $\mathcal{M}$, that maps the SSH we observe to the true SSH given by
% \begin{align} \label{eq:interp_problem}
%     \mathcal{M} &: \boldsymbol{\eta}_{obs}(\mathbf{x}, t, \boldsymbol{\mu}) \rightarrow \boldsymbol{\eta}(\mathbf{x},t),
% %     , \hspace{10mm}
% % \mathbf{x} \in \Omega \subseteq \mathbb{R}^{D_s}, \hspace{10mm} 
% % t \in \mathcal{T} \subseteq \mathbb{R}^+.
% \end{align}
% which is essentially an inverse problem that maps the observations to the state.
% One could think of it as trying to find the inverse operator, $\mathcal{M}=\mathcal{H}^{-1}$, but this could be some other arbitrary operator.  
% %
% \subsection*{Machine Learning Model Ontology} \label{sec:ml_ontology_mini}

% In general, we are interested in finding some parameterized operator, $\mathcal{M}_{\boldsymbol{\theta}}$, that maps the incomplete SSH field to the complete SSH field
% \begin{align} \label{eq:ml_interp_problem}
%     \mathcal{M}_{\boldsymbol{\theta}} &: \boldsymbol{\eta}_{obs}(\mathbf{x}, t, \boldsymbol{\mu}) \rightarrow \boldsymbol{\eta}(\mathbf{x},t),
% \end{align}
% whereby we learn the parameters from data.
% %
% The two main tasks we can define from this problem setup are 1) interpolation and 2) extrapolation.
% We define \textit{interpolation} as the case when the boundaries of the inferred state domain lie within a predefined shape for the boundaries of the spatiotemporal observation domain. 
% For example, the shape of the spatial domain could be a line, box, or sphere, and the shape of the temporal domain could be a positive real number line.
% We define \textit{extrapolation} as the case where the boundaries of the inferred state domain are outside the boundaries of the spatiotemporal observation domain. 
% In this case, the inferred state domain could be outside of either domain or both. 
% A prevalent specific case of extrapolation is \textit{hindcasting} or \textit{forecasting}, where the inferred state domain lies within the spatial observation domain's boundaries but outside of the temporal observation domain's.
% In the rest of this paper, we will look exclusively at the interpolation problem. 
% However, we refer the reader to appendix~\ref{sec:other_tasks} for a more detailed look at other subtasks that can arise.

% From a ML point of view, we can explore various ways to define the operator in equation~\eqref{eq:interp_problem}. 
% We may distinguish three main categories: (i) coordinate-based methods that learn a parameterized continuous function to map the domain coordinates to the scalar values, (ii) the explicit mapping of the state from the observation, (iii) implicit methods defined as the solution of an optimization problem. 
% The first category comprises of kriging approaches, which have been used operationally with historical success~\cite{KRIGINGREVIEW,DUACS}. Beyond such covariance-based approaches, recent contributions explore more complex trainable functional models~\cite{GPsBIGDATA}, basis functions~\cite{MIOST}, and neural networks~\cite{NERFSSSH}. 
% The second category of schemes bypasses the physical modeling aspect and amortizes the prediction directly using state-of-the-art neural architectures such as UNets and ConvLSTMs~\cite{SSHInterpAttention, SSHInterpConvLSTM, SSHInterpUNet}. 
% This category may straightforwardly benefit from available auxiliary observations~\citep{CDSOBSSST,CDSOBSSSTENS,CDSOBSOC} 
% % (including available operational gap-free SST products~\citep{CDSOBSSST,CDSOBSSSTENS} and other sea surface quantities~\citep{CDSOBSOC})
% to state the interpolation problem as a super-resolution~\cite{SuperResSurvey} or image-to-image translation problem~\cite{IMAGE2IMAGETRANSLATION, IMAGE2IMAGETRANSLATION2}. 
% The third category relates to inverse problem formulations and associated deep learning schemes, for example deep unfolding methods and plug-and-play priors~\cite{DEEPUNFOLDING}. 
% Interestingly, recent contributions explore novel neural schemes which combine data assimilation formulations~\cite{DAGEOSCIENCE} and learned optimizer strategies~\cite{4DVARNETSWOT,4DVARNETSST}.
% We provide a more detailed ontology of methods used for interpolation problems in appendix~\ref{sec:ml_ontology}. 
% We consider at least one baseline approach from each category for each data challenge described in section~\ref{sec:data_challenges}. 
% While all these methods have pros and cons, we expect the OceanBench platform to showcase to new experimental evidence and understanding regarding their applicability to SSH interpolation problems.
 

\subsection*{Experimental Design} \label{sec:experimental_design}



% \begin{table}[ht]
% \label{tb:datasets}
% \centering
% \makebox[\textwidth]{
% \begin{tabular}{lcccc}
%  \toprule
%  & OSSE & OSSE NADIR + SWOT & OSSE SST & OSE NADIR  \\ \midrule
%  Data Type & Simulations & 
% Pseudo-Observations & 
%  Simulations & Observations \\
% Source     & 
% NEMO~\citep{NEMOAJAYI2020} & 
% NEMO~\citep{NEMOAJAYI2020} &
% NEMO~\citep{NEMOAJAYI2020}
% % \multicolumn{3}{c}{NEMO GCM\citep{NEMOAJAYI2020}}  
% & Altimetry~\citep{MDSALONGTRACK} \\
% Region & 
% GulfStream & GulfStream & GulfStream & GulfStream \\
% Domain Size &
% % ($L_x\times L_y$) 
% $10\times 10^\circ$ &
% $10\times 10^\circ$ &
% $10\times 10^\circ$ &
% $10\times 10^\circ$
% \\
% Longitude Extent &
% $[-65^\circ, -55^\circ]$ & 
% $[-65^\circ, -55^\circ]$ &
% $[-65^\circ, -55^\circ]$ &
% $[-65^\circ, -55^\circ]$ \\
% Latitude Extent &
% $[33^\circ, 43^\circ]$ &
% $[33^\circ, 43^\circ]$ &
% $[33^\circ, 43^\circ]$ &
% $[33^\circ, 43^\circ]$ \\
% Resolution &
% % ($\Delta_x\times \Delta_y$) 
% $0.05^\circ\times 0.05^\circ$ &
% $0.05^\circ\times 0.05^\circ$ &
% $0.05^\circ\times 0.05^\circ$ &
% $7$ km \\
% Grid Size &
% $200\times 200$ & $200\times 200$ & $200\times 200$ & N/A \\
% Num Datapoints &
% $\sim$14.6M & $\sim$14.6M & $\sim$14.6M & $\sim$1.6M \\
% Period Start & 2012-10-01 & 2012-10-01 & 2012-10-01 & 2016-12-01 \\
% Period End & 2013-09-30 & 2013-09-30 & 2013-09-30 & 2018-01-31 \\
% Frequency  & Daily & Daily & Daily & 1 Hz \\
% \bottomrule
% \end{tabular}}
% \caption{This table gives a brief overview of the datasets provided to complete the data challenges listed in~\ref{sec:data_challenges} and~\ref{sec:data_challenges_extended}. Note that the OSSE datasets are all gridded products whereas the OSE NADIR is an alongtrack product. See figure~\ref{fig:oceanbench_maps} for an example of the OSSE NEMO Simulations for SSH and SST and pseudo-observations for NADIR \& SWOT.}
% \end{table}

The availability of multi-year simulation and observation datasets naturally advocates for the design of synthetic (or twin) experiments, referred to as observing system simulation experiments (OSSE), and of real-world experiments, referred to as observing system experiments (OSE).
We outline these two experimental setups below.

\textbf{Observing System Simulation Experiments (OSSE)}. A staple and groundtruthed experimental setup uses a reference simulation dataset to simulate the conditions we can expect from actual satellite observations. 
This setup allows researchers and operational centers to create a fully-fledged pipeline that mirrors the real-world experimental setting.
An ocean model simulation is deployed over a specified spatial domain and period, and a satellite observation simulator is deployed to simulate satellite observations over the same domain and period. 
This OSSE setup has primarily been considered for performance evaluation, as one can assess a reconstruction performance over the entire space-time domain. It also provides the basis for the implementation of classic supervised learning strategies~\cite{SSHInterpUNet,SSHInterpConvLSTM,SSHInterpAttention}.
The domain expert can vary the experimental conditions depending on the research question. 
For example, one could specify a region based on the expected dynamical regime~\cite{DCOSSEGULFSSH} or add a certain noise level to the observation tracks based on the satellite specifications.
The biggest downside to OSSE experiments is that we train models exclusively with ocean simulations which could produce models that fail to generalize to the actual ocean state. 
Furthermore, the simulations are often quite expensive, which prevents the community from having high spatial resolution over very long periods, which would be essential to capture as many dynamical regimes as possible.
\newpage

\begin{figure}[H]
\small
\begin{center}
\setlength{\tabcolsep}{1pt}
\makebox[\textwidth]{
\begin{tabular}{ccc}
NADIR Altimetry Tracks & 
SWOT Altimetry Tracks &
Sea Surface Temperature \\
\includegraphics[width=42.5mm, height=30mm]{00_Oceanbench/content/figures/maps/sla/dc20a_ssh_anomaly_nadir4_20121027.png} 
% \includegraphics[bb=0 0 4 3]{content/figures/maps/sla/dc20a_ssh_anomaly_nadir4_20121027.png} 
&
\includegraphics[width=42.5mm, height=30mm]{00_Oceanbench/content/figures/maps/sla/dc20a_ssh_anomaly_swot1nadir5_20121027.png} &
\includegraphics[width=4.25cm,height=3cm]{00_Oceanbench/content/figures/maps/sst/dc20a_nemo_sst.png}
\end{tabular}}
\makebox[\textwidth]{
\begin{tabular}{cccc}
\hspace{3mm} NEMO Simulation & 
\hspace{3mm} MIOST & 
\hspace{3mm} BFNQG & 
4DVarNet \\
\vspace{-2mm}
%%%%% SEA LEVEL ANOMALY %%%%%%%%
\includegraphics[trim={0 0 42mm 0},clip, width=3.20cm,height=3cm]{00_Oceanbench/content/figures/maps/sla/dc20a_nemo_sla.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/sla/dc20a_miost_sla.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/sla/dc20a_bfnqg_sla.png} &
\includegraphics[width=4.0cm,height=3cm]{00_Oceanbench/content/figures/maps/sla/dc20a_4dvarnet_sla.png} \\
\vspace{-2mm}
%%%%% KINETIC ENERGY %%%%%%%%
\includegraphics[trim={0 0 42mm 0},clip, width=3.20cm,height=3cm]{00_Oceanbench/content/figures/maps/ke/dc20a/nadir4/dc20a_nemo_ke.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/ke/dc20a/nadir4/dc20a_miost_ke.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/ke/dc20a/nadir4/dc20a_bfnqg_ke.png} &
\includegraphics[width=4.0cm,height=3cm]{00_Oceanbench/content/figures/maps/ke/dc20a/nadir4/dc20a_4dvarnet_ke.png}  \\
\vspace{-2mm}
%%%%% RELATIVE VORTICITY %%%%%%%%
\includegraphics[trim={0 0 42mm 0},clip, width=3.20cm,height=3cm]{00_Oceanbench/content/figures/maps/rvort/dc20a/nadir4/dc20a_nemo_vort_r.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/rvort/dc20a/nadir4/dc20a_miost_vort_r.png} &
\includegraphics[trim={0 0 42mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/rvort/dc20a/nadir4/dc20a_bfnqg_vort_r.png} &
\includegraphics[width=4.0cm,height=3cm]{00_Oceanbench/content/figures/maps/rvort/dc20a/nadir4/dc20a_4dvarnet_vort_r.png}  \\
%%%%% STRAIN %%%%%%%%
\includegraphics[trim={0 0 38mm 0},clip, width=3.20cm,height=3cm]{00_Oceanbench/content/figures/maps/strain/dc20a/nadir4/dc20a_nemo_strain.png} &
\includegraphics[trim={0 0 38mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/strain/dc20a/nadir4/dc20a_miost_strain.png} &
\includegraphics[trim={0 0 38mm 0},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/maps/strain/dc20a/nadir4/dc20a_bfnqg_strain.png} &
\includegraphics[width=4.0cm,height=3cm]{00_Oceanbench/content/figures/maps/strain/dc20a/nadir4/dc20a_4dvarnet_strain.png}  \\
% \vspace{-2mm}
(a) & (b) & (c) & (d)
\end{tabular}}
\vspace{-3mm}
% \caption{Row I - Isotrophic PSD. Row 2 - Isotrophic PSD Score}
\caption{
A snapshot at $27^{th}$ October, 2012 of the sea level anomaly (SLA) from the NEMO simulation for the OSSE experiment outlined in section~\ref{sec:experimental_design}. 
The top row showcases the aggregated NADIR altimetry tracks and the aggregated SWOT altimetry tracks (12 hours before and 12 hours after) as well as the SST from the NEMO simulation.
Each subsequent row showcases the following physical variables found in appendix~\ref{sec:physical_variables}: (a) Sea Level Anomaly, (b) Kinetic Energy, (c) Relative Vorticity, and (d) Strain. 
Each column in the subsequent rows showcase the following reconstructed field from the NEMO simulation found in columrn (a): (b) MIOST~\cite{MIOST}, (c) BFN-QG~\cite{BFNQG}, and (d) 4DVarNet~\cite{4DVARNETSWOT}.}
\label{fig:oceanbench_maps}
\vspace{-5mm}
\end{center}
\end{figure}


\begin{landscape}
\small
\begin{table}[ht]


\centering
\makebox[\textwidth]{
\begin{tabular}{lcclclcc}
 \toprule
     & OSSE SSH      & \multicolumn{2}{c}{OSSE SSH NADIR}                     & \multicolumn{2}{c}{OSSE SSH SWOT}                      & OSSE SST             & OSE SSH NADIR            \\ \midrule\midrule
Data Structure & Gridded              & AlongTrack           & \multicolumn{1}{c}{Gridded} & AlongTrack           & \multicolumn{1}{c}{Gridded} & Gridded              & AlongTrack           \\
     & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} &                             & \multicolumn{1}{l}{} &  \\ \midrule
Source     & 
NEMO~\citep{NEMOAJAYI2020} &
NEMO~\citep{NEMOAJAYI2020} &
NEMO~\citep{NEMOAJAYI2020} &
NEMO~\citep{NEMOAJAYI2020} & 
NEMO~\citep{NEMOAJAYI2020} &
NEMO~\citep{NEMOAJAYI2020}
% \multicolumn{3}{c}{NEMO GCM\citep{NEMOAJAYI2020}}  
& Altimetry~\citep{MDSALONGTRACK} \\
Region & 
GulfStream & GulfStream & GulfStream & GulfStream &
GulfStream & GulfStream & GulfStream
\\
Domain Size [$^\circ$] &
% ($L_x\times L_y$) 
$10\times 10^\circ$ &
$10\times 10^\circ$ &
$10\times 10^\circ$ &
$10\times 10^\circ$ &
$10\times 10^\circ$ &
$10\times 10^\circ$ &
$10\times 10^\circ$ \\
Domain Size [km] &
% ($L_x\times L_y$) 
$1100\times 1100$ &
$1100\times 1100$ &
$1100\times 1100$ &
$1100\times 1100$ &
$1100\times 1100$ &
$1100\times 1100$ &
$1100\times 1100$ \\
Longitude Extent &
$[-65^\circ, -55^\circ]$ & 
$[-65^\circ, -55^\circ]$ & 
$[-65^\circ, -55^\circ]$ & 
$[-65^\circ, -55^\circ]$ & 
$[-65^\circ, -55^\circ]$ &
$[-65^\circ, -55^\circ]$ &
$[-65^\circ, -55^\circ]$ \\
Latitude Extent &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ &
$[33^\circ, 43^\circ]$ \\
Resolution [$^\circ$] &
% ($\Delta_x\times \Delta_y$) 
$0.05^\circ\times 0.05^\circ$ &
N/A &
$0.05^\circ\times 0.05^\circ$ &
N/A &
$0.05^\circ\times 0.05^\circ$ &
$0.05^\circ\times 0.05^\circ$ &
N/A \\
Resolution [km] &
% ($\Delta_x\times \Delta_y$) 
$5.5\times 5.5$ &
$6$ &
$5.5\times 5.5$ &
$6$ &
$5.5\times 5.5$ &
$5.5\times 5.5$ &
$7$ \\
Grid Size &
$200\times 200$ & 
N/A &
$200\times 200$ & 
N/A &
$200\times 200$ & 
$200\times 200$ & 
N/A \\
Num. Datapoints &
$\sim$14.6M & 
$\sim$205K & 
$\sim$14.6M & 
$\sim$955K & 
$\sim$14.6M & 
$\sim$14.6M & 
$\sim$1.79M \\ \midrule
Period Start & 
2012-10-01 & 2012-10-01 & 2012-10-01 & 2012-10-01 & 
2012-10-01 & 2012-10-01 & 2016-12-01 \\
Period End & 
2013-09-30 & 2013-09-30 & 2013-09-30 & 2013-09-30 & 
2013-09-30 & 2013-09-30 & 2018-01-31 \\
Frequency  & 
Daily & 1 Hz  & Daily & 1 Hz  & Daily & Daily & 1 Hz \\ 
Period Length & 365 Days & 365 Days & 365 Days &
365 Days & 365 Days & 365 Days & 427 Days \\
\midrule
Evaluation Start & 
2012-10-22 & 2012-10-22 & 2012-10-22 & 2012-10-22 & 
2012-10-22 & 2012-10-22 & 2017-01-01 \\
Evaluation End & 
2012-12-02 & 2012-12-02 & 2012-12-02 & 2012-12-02 & 
2012-12-02 & 2012-12-02 & 2017-12-31 \\ 
Evaluation Length & 45 Days & 45 Days & 45 Days &
45 Days & 45 Days & 45 Days & 365 Days \\
\bottomrule
\end{tabular}}
\caption{This table gives an extended overview of the datasets provided to complete the data challenges listed in~\ref{sec:data_challenges} and~\ref{sec:data_challenges_extended}. The OSSE SST and SSH are outputs from come from the free run NEMO model~\citep{NEMOAJAYI2020}. The OSSE NADIR and SWOT are pseudo-observations generated from the NEMO simulation. We provide the original simulated satellite tracks as well as a gridded version at the same resolution as the simulation. 
}
\label{c5tb:datasetsmega}
\end{table}
\end{landscape}

% \subsubsection{Observing System Experiments (OSE)} \label{sec:ose}

\textbf{Observing System Experiments (OSE)}. As more observations have become available over the past few decades, we can also design experiments using real data. 
This involves aggregating as many observations from real ocean altimetry satellites as possible with some specific independent subset left out for evaluation purposes.
A major downside to OSE experiments is that the sparsity and spatial coverage of the observations narrow the possible scope of performance metrics and make it very challenging to learn directly from observation datasets. 
The current standard altimetry data are high resolution but cover a tiny area. 
As such, it can only inform fine-scale SSH patterns in the along-track satellite direction and cannot explicitly reveal two-dimensional patterns. 
Despite these drawbacks, it provides a quantitative evaluation of the generalizability of the ML methods concerning the true ocean state.




%and so it fails to capture many of the dynamical regimes we are interested in, i.e. mesoscale and sub-mesoscale processes. 
%However, it is still advantageous (and preferable) to include these experiments because these reflect the true ocean state and will help with the generalizability of the ML methods.

\begin{figure}[H]
\small
\begin{center}
\setlength{\tabcolsep}{2pt}
\makebox[\textwidth]{
\begin{tabular}{ccc}
% $\mathcal X$ & $\hat \z = \bG_\theta(\x)$ & $\x = \bG_\theta^{-1} (\hat \z)$\\[0mm]
% NATL60&
% \multicolumn{2}{c}{\includegraphics[width=6.25cm,height=4.5cm]{content/figures/exp_natl60/psd_st/osse_2020a_psd_natl60}} 
% \\
\includegraphics[width=3.75cm,height=3.25cm]{00_Oceanbench/content/figures/stats/nrmse_space.png} &
\includegraphics[width=4.25cm,height=3.5cm]{00_Oceanbench/content/figures/psd_isotropic/dc20a/nadir4/dc20a_psd_iso_ssh.png} &
\includegraphics[width=4.25cm,height=3.5cm]{00_Oceanbench/content/figures/psd_isotropic/dc20a/nadir4/dc20a_psd_score_iso_ssh.png} 
\\
(a) Normalized RMSE &
(b) Isotropic Power Spectrum &
(c) Isotropic Power Spectrum Score
\end{tabular}}
\makebox[\textwidth]{
\begin{tabular}{cccc}
\includegraphics[trim={0 0 0mm 0},clip, width=4.20cm,height=3cm]{00_Oceanbench/content/figures/psd_spacetime/dc20a/nadir4/dc20a_psd_spacetime_nemo_nadir4_ssh.png}  &
\includegraphics[trim={20mm 0 34mm 0},clip, width=2.9cm,height=3cm]{00_Oceanbench/content/figures/psd_spacetime/dc20a/nadir4/dc20a_psd_spacetime_score_miost_nadir4_ssh.png} &
\includegraphics[trim={20mm 0 34mm 0},clip, width=2.9cm,height=3cm]{00_Oceanbench/content/figures/psd_spacetime/dc20a/nadir4/dc20a_psd_spacetime_score_bfnqg_nadir4_ssh.png} &
\includegraphics[trim={20mm 0 0 0},clip, width=3.5cm,height=3cm]{00_Oceanbench/content/figures/psd_spacetime/dc20a/nadir4/dc20a_psd_spacetime_score_4dvarnet_nadir4_ssh.png} \\
(d) NEMO Simulation &
(e) MIOST &
(f) BFN-QG &
(g) 4DVarNet
\end{tabular}}
% % \vspace{-4mm}
% \caption{Row I - Isotrophic PSD. Row 2 - Isotrophic PSD Score}
\caption{This figure showcases some statistics for evaluation of the SSH field reconstructions for the OSSE NADIR experiment outlined in section~\ref{sec:interp_challenge}. Subfigure (a) showcases the normalized root mean squared error (nRMSE), (b) showcases the isotropic power spectrum decomposition (PSD), (c) showcases isotropic PSD scores.
The bottom row showcases the space-time PSD for the NEMO simulation (subfigure (d)) and the PSD scores for three reconstruction models: (e) the MIOST model~\cite{MIOST}, (f) the BFN-QG model~\cite{BFNQG}, and (g) the 4DVarNet model~\cite{4DVARNETSWOT}.
}
% \vspace{-5mm}
\label{fig:oceanbench_psd}
\end{center}
\end{figure}


%
\subsection*{Data Challenges} \label{sec:data_challenges}
We rely on existing OSSE and OSE experiments for SSH interpolation designed by domain experts~\cite{DCOSEGULFSSH,DCOSSEGULFSSH} and recast them into \texttt{OceanBench} framework to deliver a ML-ready benchmarking suites. 
The selected data challenges for this first edition address SSH interpolation for a 1000km$\times$1000km Gulfstream region. We describe each of them below.

% \subsection*{OSSE NADIR} \label{sec:osse_nadir}
\textbf{Experiment I (\textit{OSSE NADIR})} addresses SSH interpolation using NADIR altimetry tracks which are very fine, thin ocean satellite observations (see Figure~\ref{fig:oceanbench_maps}). It relies on an OSSE using high-resolution ($1/60^\circ$ resolution) ocean simulations generated by the NEMO model over one year with a whole field every day. 
The reference simulation is the \textit{NATL60} simulation based on the NEMO model~\cite{NEMOAJAYI2020}. 
This particular simulation was run over an entire year without any tidal forcing.
The simulation provides the outputs of SSH, SST, sea surface salinity (SSS) and the u,v velocities every 1 hour.
For the purposes of this data challenge, the spatial domain is over the Gulfstream with a spatial domain of $[-65^\circ, -55^\circ]$ longitude and $[33^\circ, 43^\circ]$ latitude.
The resolution of the original simulation is 1/60$^\circ$ resolution with hourly snapshots, and we consider a daily downsampled trajectory at 1/20$^\circ$ for the data challenge which results in a 365x200x200 spatio-temporal grid.
This simulation resolves finescale dynamical processes ($\sim$15km) which makes it a good test bed for creating an OSSE environment for mapping.
The SSH observations include simulations of ocean satellite NADIR tracks.
In particular, they are simulations of Topex-Poseidon, Jason 1, Geosat Follow-On, and Envisat.
There is no observation error considered within the challenge.
We use a the entire period from 2012-10-10 until 2013-09-30.
A training period is only from 2013-01-02 to 2013-09-30 where the users can use the reference simulation as well as all available simulated observations.
The evaluation period is from 2012-10-22 to 2012-12-02 (i.e. 41 days) which is considered decorrelated from the training period. 
During the evaluation period, the user cannot use the reference NATL60 simulation but they can use all available simulated observations. There is also a spin-up period allowance from 2012-10-01 where the user can also use all available simulated observations.

% \subsection*{OSSE SWOT \& OSSE SST} \label{sec:osse_swot_sst}
\textbf{Experiment II (\textit{OSSE SWOT})} addresses SSH interpolation using jointly NADIR and SWOT altimetry data where we complement the \textbf{OSSE NADIR} configuration with simulated SWOT observations.
SWOT is a new satellite altimetry mission with a much higher spatial coverage but a much lower temporal resolution as illustrated in Figure~\ref{fig:oceanbench_maps}.
The higher spatial resolution allows us to see structures at a smaller resolution but at the cost of a massive influx of observations (over $\times$100).

\textbf{Experiment III (\textit{OSSE SST})} addresses SSH interpolation using altimetry and SST satellite data jointly. We complement the \textbf{OSSE SWOT} challenge with simulated SST observations. 
Satellite-derived SST observations are more abundantly available in natural operational settings than SSH at a finer resolution, and structures have visible similarities~\cite{SWOT,BFNQG}.
So this challenge allows for methods to take advantage of multi-modal learning~\cite{4DVARNETSST,SSHInterpAttention}.

For the OSSE SWOT and OSSE SST experiments, the reference simulation, domain, and evaluation period is the same as the OSSE NADIR experiment.
However, the OSSE SWOT includes simulated observations of the novel KaRIN sensor recently deployed during the SWOT mission, the pseudo-observations were generated using the SWOT simulator~\cite{SWOT}. 
This OSSE SST experiment allows the users to utilize the full fields of SST as inputs to help reconstruct the SSH field in conjunction with the NADIR and SWOT SSH observation.
Because the SST comes from the same NATL60 simulation, the geometry characteristics SST and SSH are exactly the same.

% \subsection*{OSE NADIR} \label{sec:ose_nadir}

\textbf{Experiment IV (\textit{OSE NADIR})} addresses SSH interpolation for real NADIR altimetry data. 
In contrast to the three OSSE data challenges, it only looks at actual observations aggregated from the currently available ocean altimetry data from actual satellites. 
It involves a similar space-time sampling as Experiment (\textbf{OSSE NADIR}) to evaluate the generalization of ML methods trained in Experiment I to real altimetry data. 
The training problem's complexity increases significantly due to the reference dataset's sparsity compared with the \textbf{OSSE NADIR} dataset. 
One may also explore transfer learning or fine-tuning strategies from the available OSSE dataset. 

The OSE NADIR experiment only uses real observations aggregated from different altimeters. These SSH observations include observations from the SARAL/Altika, Jason 2, Jason 3, Sentinel 3A, Haiyang-2A and Cryosat-2 altimeters. The Cryosat-2 altimeter is used as the independent evaluation track used to assess the performance of the reconstructed SSH field.
\newpage


\subsection*{Metrics} \label{sec:metrics}

There are many metrics that are standard within the ML community but unconvincing for many parts the geoscience community. 
Specifically, many of these standard scores do not capture the important optimization criteria in the scientific machine learning tasks.
However, there is not consensus within domain-specific communities about the perfect metric which captures every aspect we are interested.
Therefore, we should have a variety of scores from different perspectives to really assess the pros and cons of each method we wish to evaluate thoroughly. 
Below, we outline two sets of scores we use within this framework: skill scores and spectral scores.

\textbf{Skill Scores}

We classify one set of metrics as \textit{skill scores}. 
These are globally averaged metrics which tend to operate within the real space.
Some examples include the root mean squared error (RMSE), the normalized root mean squared (nRMSE) error, and the nRMSE score.
The RMSE metric can also be calculated w.r.t. the spatial domain, temporal domain or both. 
For example, figure~\ref{fig:oceanbench_psd} showcases the nRMSE score calculated only on the spatial domain and visualized for each time step.
%
\begin{align}
    \text{RMSE}: &&\text{RMSE}(\eta,\hat{\eta}) &= ||\eta - \hat{\eta}||_2 \label{eq:RMSE}\\
    % \text{RMSE}_t: &&\text{RMSE}_t(\eta,\hat{\eta}; t) &= ||\eta(t) - \hat{\eta}(t)||_2 \label{eq:RMSE_t}\\
    \text{nRMSE}: &&\text{nRMSE}(\eta,\hat{\eta}) &= \frac{\text{RMSE}(\eta,\hat{\eta})}{||\eta||_2} \label{eq:nRMSE} \\
    \text{nRMSE}_{\text{score}}: &&\text{nRMSE}_{\text{score}}(\eta,\hat{\eta}) &= 1 - \text{nRMSE}(\eta,\hat{\eta})
    \label{eq:nRMSE_score}
\end{align}
%
However, we are not limited to just the standard MSE metrics.
We can easily incorporate more higher-order statistics like the Centered Kernel Alignment (CKA)~\cite{METRICSCKA} or information theory metrics like mutual information (MI)~\cite{METRICSITRBIG,METRICSITRBIG2}.
In addition, we could also utilize the same metrics in the frequency domain as is done in~\citep{PDEBench}.

\textbf{Spectral Scores}

Another class of scores that we use in \texttt{OceanBench} are the \textit{spectral scores}. These scores are calculated within the spectral space via the wavenumber power spectral density (PSD). 
This provides a spatial-scale-dependent metric which is useful for identifying the largest and smallest scales that were resolved by the reconstruction map. 
In general, we use these to measure the expected energy at different spatiotemporal scales and we can also construct custom score functions which gives us a summary statistic for how well we reconstructed certain scales.
%
\begin{align}
    \text{PSD}: &&\text{PSD}(\eta) &= \sum_{k_{min}}^{k_{max}}\|\mathcal{\mathcal{F}(\eta)}\|^2\label{psd}\\
    \text{PSD}_{score}: &&\text{PSD}_{score}(\eta,\hat{\eta}) &= 1 - \frac{\text{PSD}(\eta - \hat{\eta})}{\text{PSD}(\eta)} \label{eq:psd_score}
\end{align}
%
where $\mathcal{F}$ is the Fast Fourier Transformation (FFT). 
In our application, there are various ways to construct the PSD which depend on the FFT transformation.
We denote the \textit{space-time PSD} as $\lambda_\mathbf{x}$ which does the 2D FFT in the longitude and time direction, then takes the average over the latitude.
We denote the \textit{space-time PSD} as $\lambda_\mathbf{t}$ which does the 2D FFT in the longitude and latitude direction, then takes the average over the time.
We denote the \textit{isotropic PSD} as $\lambda_r$ which assumes a radial relationship in the spatial domain and then averages over the temporal domain.
Lastly, we denote the standard PSD score as $\lambda_a$ which is the 1D FFT over a prescribed distance along the satellite track; this is what is done for the OSE NADIR experiment.
We recognize that the FFT configurations are limited due to their global treatment of the spectral domain and we need more specialized metrics to handle the local scales.
This opens the door to new metrics that handle such cases such as the Wavelet transformation~\cite{METRICSWAVELET}.

\include{00_Oceanbench/content/appendix/fourdvarnet_psds}


\subsection*{Physical Variables} \label{sec:physical_variables}

We have access to many physical quantities which can be derived from sea surface height. 
This gives us a way to analyze how effective and trustworthy are our reconstructions. 
Many machine learning methods are unconstrained so they may provide solutions that are physically inconsistent and visualizing the field is a very easy eye test to assess the validity. 
In addition to post analysis, one could include some of these derived quantities maybe useful as additional inputs to the system and/or constraints to the loss function. 

We are interested in the domain across the earth's surface.
let us define the earth's domain by some spatial coordinates, $\mathbf{x} = [\text{longitude},\text{latitude}]^\top \in\mathbb{r}^{d_s}$, and temporal coordinates, $t=[\text{time}]\in\mathbb{r}^+$, where $d_s$ is the dimensionality of the coordinate vector.
we can define some spatial (sub-)domain, $\omega\subseteq\mathbb{r}^{d_s}$, and a temporal (sub-)domain, $\mathcal{t}\subseteq\mathbb{r}^+$.
this domain could be the entire globe for 10 years or a small region within the north atlantic for 1 year.
\begin{align}  \label{eq:spatiotemporal_coords}
    \text{spatial coordinates}: && \mathbf{x} &\in \omega \subseteq \mathbb{r}^{d_s}\\
    \text{temporal coordinates}: && t &\in \mathcal{t} \subseteq \mathbb{r}^+.
\end{align}
in this case $d_s=2$ because we only have a two coordinates, however we can do some coordinate transformations like spherical to cartesian. likewise, we can do some coordinate transformation for the temporal coordinates like cyclic transformations or sinusoidal embeddings~\cite{attention}.

\textbf{Sea Surface Height} is the deviation of the height of the ocean surface from the geoid of the Earth. We can define it as:
\begin{align}
	\text{Sea Surface Height }[m]:&& \quad
 \eta &= \boldsymbol{\eta}(\mathbf{x},t)&& \quad \Omega\times \mathcal{T}\rightarrow\mathbb{R} \label{eq:ssh}
\end{align}
This quantity is the actual value that is given from the satellite altimeters and is presented in the products for SSH maps~\cite{DUACS}. An example can be seen in the first row of figure~\ref{fig:oceanbench_maps_4dvarnet}.

\textbf{Sea Surface Anomaly} is the anomaly wrt to the spatial mean which is defined by
\begin{align}
	\text{Sea Level Anomaly }[m]:&& \quad
 \bar{\eta} &= \boldsymbol{\eta}(\mathbf{x},t) - \bar{\eta}(t) &&
 \quad \Omega\times \mathcal{T}\rightarrow\mathbb{R} \label{eq:sla}
\end{align}
where $\bar{\eta}(t)$ is the spatial average of the field at each time step.  
An example can be seen in the first row of figure~\ref{fig:oceanbench_maps}.

Another important quantity is the \textbf{geostrophic velocities} in the zonal and meridional directions. This is given by
\begin{align}
	\text{Zonal Velocity}[ms^{-2}]:&& \quad
 u &= -\frac{g}{f_0}\frac{\partial \eta}{\partial y} &&
 \quad \Omega\times \mathcal{T}\rightarrow\mathbb{R} \label{eq:u_vel} \\
	\text{Meridional Velocity}[ms^{-2}]:&& \quad
 v &= \frac{g}{f_0}\frac{\partial \eta}{\partial x} &&
 \quad \Omega\times \mathcal{T}\rightarrow\mathbb{R} \label{eq:v_vel}
\end{align}
where $g$ is the gravitational constant and $f_0$ is the mean Coriolis parameter. These quantities are important as they can be an related to the sea surface current. The geostrophic assumption is a very strong assumption however it can still be an important indicator variable. The \textbf{kinetic energy} is a way to summarize the (geostrophic) velocities as the total energy of the system. This is given by
\begin{equation} \label{eq:kineticenergy}
    KE = \frac{1}{2}\left(u^2 + v^2\right)
\end{equation}
An example can be seen in the second row of figure~\ref{fig:oceanbench_maps_4dvarnet}.

Another very important quantity is the \textit{vorticity} which measures the spin and rotation of a fluid. In geophysical fluid dynamics, we use the \textbf{relative vorticity} which is the vorticity observed within at rotating frame.
This is given by
\begin{equation} \label{eq:relvorticity}
    \zeta = \frac{\partial v}{\partial x} - \frac{\partial u}{\partial y}
\end{equation}
An example can be seen in the third row of figure~\ref{fig:oceanbench_maps_4dvarnet}.

% \subsection{Absolute Vorticity}

% \begin{equation} \label{eq:absvorticity}
%     |\zeta| = \frac{\partial v}{\partial x} + \frac{\partial u}{\partial y}
% \end{equation}

We can also use the \textbf{Enstrophy} to summarize the relative voriticty to measure the total contribution which is given by
\begin{equation} \label{eq:enstrophy}
    E = \frac{1}{2}\zeta^2
\end{equation}

The \textbf{Strain} is a measure of deformation of a fluid flow.

\begin{equation} \label{eq:strain}
    \sigma = \sqrt{\sigma_n^2 + \sigma_s^2}
\end{equation}

where $\sigma_n$ is the shear strain (aka the shearing deformation) and $\sigma_s$ is the normal strain (aka stretching deformation). An example can be seen in the fourth row of figure~\ref{fig:oceanbench_maps_4dvarnet}.

The \textbf{Okubo-Weiss Parameter} is high-order quantity which is a linear combination of the strain and the relative vorticity.

\begin{equation} \label{eq:okuboweiss}
    \sigma_{ow} = \sigma_n^2 + \sigma_s^2 - \zeta^2
\end{equation}

This quantity is often used as a threshold for determining the location of Eddies in sea surface height and sea surface current fields~\cite{OKUBO, WEISS, OKUBOWEISS}.
\subsection*{Results}

We use \texttt{OceanBench} to generate maps of relevant quantities from the 4DVarNet method~\cite{4DVARNETSWOT,4DVARNETSST}.
Figure~\ref{fig:oceanbench_maps_4dvarnet} showcases some demo maps for some key physical variables outlined in section~\ref{sec:physical_variables}.
We showcase the 4DVarNet method because it is the SOTA method that was applied to each of the data challenges.
We can see that the addition of more information, i.e. NADIR -> SWOT -> SST, results in maps look more similar to the NEMO simulation in the OSSE challenges.
It also produces sensible maps for the OSE challenge as well.

\texttt{OceanBench} also generated figure~\ref{fig:oceanbench_psd_4dvarnet} which shows plots of the PSD and PSD scores of SSH for the different challenges.
Again, as we increase the efficacy of the observations via SWOT and allow for more external factors like the SST, we get an improvement in the isotropic and spacetime PSD scores.
In addition, we see that the PSD plots for the OSE task look very similar to the OSE challenges. 

Lastly, we used \texttt{OceanBench} to generate a leaderboard of metrics for a diverse set of algorithms where the maps were available online.
Table~\ref{tb:expresults} displays all of the key metrics outlined in section~\ref{sec:metrics} including the normalized RMSE and various spectral scores which are appropriate for the challenge.
We see that as the complexity of the method increases, the metrics improve. 
In addition, the methods that involve end-to-end learning perform the best overall, i.e. 4DVarNet.

\begin{figure}[h]
\small
\begin{center}
\setlength{\tabcolsep}{1pt}
\makebox[\textwidth]{
\begin{tabular}{cccc}
\hspace{3mm} Task OSSE & 
\hspace{3mm} Task OSSE & 
\hspace{2mm} Task OSSE & 
Task OSE \\
\hspace{3mm}  Nadir & 
\hspace{3mm} Nadir + SWOT & 
\hspace{2mm} Nadir + SST & 
Nadir \\
%\vspace{-2mm}
%%%%% SSH %%%%%%%%
\includegraphics[trim={0 13mm 22mm 0},clip, width=3.60cm,height=3.2cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_ssh.png} &
\includegraphics[trim={13mm 13mm 22mm 0},clip, width=3.2cm,height=3.2cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadirswot_ssh.png} &
\includegraphics[trim={13mm 13mm 22mm 0},clip, width=3.2cm,height=3.2cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_sst_ssh.png} &
\includegraphics[trim={13mm 13mm 0 0},clip,width=4.0cm,height=3.2cm]{00_Oceanbench/content/figures/fourdvarnet_figs/ose_gf_ssh.png} \\
%\vspace{3mm}
%%%%% KINETIC ENERGY %%%%%%%%
\includegraphics[trim={0 13mm 22mm 5mm}, clip, width=3.60cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_ke.png} &
\includegraphics[trim={13mm 13mm 22mm 5mm},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadirswot_ke.png} &
\includegraphics[trim={13mm 13mm 22mm 5mm},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_sst_ke.png} &
\includegraphics[trim={13mm 13mm 0 5mm},clip,width=4cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/ose_gf_ke.png} \\
%%%%% RELATIVE VORTICITY %%%%%%%%
\includegraphics[trim={0 13mm 21.2mm 5mm},clip, width=3.60cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_vort_r.png} &
\includegraphics[trim={13mm 13mm 21.2mm 5mm},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadirswot_vort_r.png} &
\includegraphics[trim={13mm 13mm 21.2mm 5mm},clip, width=3.2cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_sst_vort_r.png} &
\includegraphics[trim={13mm 13mm 0 5mm},clip,width=4.0cm,height=3cm]{00_Oceanbench/content/figures/fourdvarnet_figs/ose_gf_vort_r.png} \\
%%%%% STRAIN %%%%%%%%
\includegraphics[trim={0 0 19mm 5mm},clip, width=3.60cm,height=3.4cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_strain.png} &
\includegraphics[trim={13mm 0 19mm 5mm},clip, width=3.2cm,height=3.4cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadirswot_strain.png} &
\includegraphics[trim={13mm 0 19mm 5mm},clip, width=3.2cm,height=3.4cm]{00_Oceanbench/content/figures/fourdvarnet_figs/osse_gf_nadir_sst_strain.png} &
\includegraphics[trim={13mm 0 0 5mm},clip,width=4.0cm,height=3.4cm]{00_Oceanbench/content/figures/fourdvarnet_figs/ose_gf_strain.png} \\
% \vspace{-2mm}
(a) & (b) & (c) & (d)
\end{tabular}}
\vspace{-3mm}
% \caption{Row I - Isotrophic PSD. Row 2 - Isotrophic PSD Score}
\caption{
Reconstructed quantities by the 4dVarNet method for each of the four tasks.
Each row showcases the following physical variables found in appendix~\ref{sec:physical_variables}: (a) Sea Surface Height, (b) Kinetic Energy, (c) Relative Vorticity, and (d) Strain. 
Each column showcase the reconstructed from the tasks (a) OSSE using only Nadir tracks: (b) OSSE using Nadir tracks and SWOT swath, (c) Multimodal using Nadir tracks and sea surface temperature, and (d) Reconstruction using real nadir altimetry tracks.}
\label{fig:oceanbench_maps_4dvarnet}
\vspace{-5mm}
\end{center}
\end{figure}



\begin{table}[H]
% \caption{This table highlights some of the results for the OSSE experiments outlined in section~\ref{sec:osse} and~\ref{sec:other_tasks}.

% This table highlights the performance statistically in the real and spectral space; the normalized RMSE for the real space and the minimum spatial and temporal scales resolved in the spectral domain. 
% For more information about the class of models displayed and class of metrics, see section~\ref{sec:ml_ontology} and section~\ref{sec:metrics} respectively.}
\centering
\makebox[\textwidth]{
\begin{tabular}{llcccccc}
 \toprule
% Experiment & Configuration & Method & nRMSE & Resolved Scale [km]    \\ \midrule
% \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
% &  &   &  & Wavelength [km]  & Period [days]      \\ \midrule
% \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
\multirow{2}{*}{Experiment} &  \multirow{2}{*}{Algorithm} &   \multirow{2}{*}{nRMSE Score} &
\multicolumn{4}{c}{Effective Resolution} \\
& & & $\lambda_{a}$ [km] & $\lambda_{r}$ [km]   &  $\lambda_{\mathbf{x}}$ [km]  &   $\lambda_{t}$ [days]      \\ \midrule
OSSE NADIR     &  OI & 0.92 & - & 123 & 174 & 10.8 \\
OSSE NADIR     &  MIOST &  0.93 & - & 100 & 157 & 10.1 \\
OSSE NADIR     &  BFNQG & 0.93 & - & 88 & 139 & 10.4 \\
OSSE NADIR &  4DVarNet &  \textbf{0.94} & - & \textbf{65} & \textbf{117} & \textbf{7.7} \\
\midrule
OSSE SWOT     &  OI & 0.92 & - & 106 & 139 & 11.7 \\
OSSE SWOT     &  MIOST &  0.94 & - & 88 & 131 & 10.1 \\
OSSE SWOT     &  BFNQG & 0.94 & - & 64 & 118 & 36.5 \\
OSSE SWOT &  4DVarNet &  \textbf{0.96} & - & \textbf{47} & \textbf{77} & \textbf{5.6} \\
\midrule
OSSE SST     &  Musti & 0.95 & - & 46 & 138 & 4.1 \\
OSSE SST &  4DVarNet &  \textbf{0.96} & - & \textbf{46} & \textbf{87} & \textbf{3.7} \\
\midrule
OSE NADIR     &  OI & 0.88 & 151 & - &  - &  -\\
OSE NADIR     &  MIOST &  0.90 & 135 & - &  - &  -\\
OSE NADIR     &  BFNQG & 0.88 & 122 & - & - &  -\\
OSE NADIR &  ConvLSTM &  0.89 & 113 &- &  - &  -\\
OSE NADIR &  4DVarNet & \textbf{0.91} & \textbf{98} & - &  -  &  -\\
\bottomrule
\end{tabular}}
\caption{This table showcases all of the summary statistics for some methods for each of the data challenges listed in section~\ref{sec:data_challenges}. The summary statistics shown are the normalized RMSE and the effective resolution in the spectral domain. The spectral metrics for the effective resolution that were outlined in section~\ref{sec:metrics} are: i) $\lambda_a$ is the spatial score for the alongtrack PSD score, ii) $\lambda_r$ is the spatial score for the isotropic PSD, iii) $\lambda_x$ is the spatial score for space-time PSD score, and iv) $\lambda_t$ is the temporal score for the space-time PSD score.}
\label{tb:expresults}
\end{table}

\subsection*{\texttt{OceanBench} Pipelines}

% \begin{table}[h]
% \caption{This table highlights some of the results for the \textbf{OSSE NADIR} experiment outlined in section~\ref{sec:data_challenges} and appendix~\ref{sec:data_challenges_extended}.
% % and the OSE experiment outlined in section~\ref{sec:ose}~\tocite{}. 
% % For more results regarding the SWOT data, please see section~\ref{sec:other_tasks}. 
% This table highlights the performance statistically in the real and spectral space; the normalized RMSE score for the real space and the minimum spatial and temporal scales resolved in the spectral domain. 
% For more information about the class of models displayed and class of metrics, see appendix~\ref{sec:ml_ontology} and appendix~\ref{sec:metrics} respectively. We only showcase the model performance on the alongtrack NADIR data available. For the extended table for each of the challenges, see Table~\ref{tb:exp-results-mega}.}
% \label{tb:oceanbench_results}
% \centering
% \makebox[\textwidth]{
% \begin{tabular}{lllcccc}
%  \toprule
% % Experiment & Configuration & Method & nRMSE & Resolved Scale [km]    \\ \midrule
% % \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
% % &  &   &  & Wavelength [km]  & Period [days]      \\ \midrule
% % \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
% Experiment &  Algorithm &   Algorithm Class &  nRMSE Score & $\lambda_{\mathbf{x}}$ [km]  & $\lambda_{t}$ [days]      \\ \midrule
% \multicolumn{1}{l}{OSSE NADIR}     &  OI~\cite{DUACS} &  Coordinate-Based & 0.92 $\pm$ 0.01 & 175 & 10.8 \\
% \multicolumn{1}{l}{OSSE NADIR}     &  MIOST~\cite{MIOST} &  Coordinate-Based  & 0.93 $\pm$ 0.01 & 157 & 10.1 \\
% \multicolumn{1}{l}{OSSE NADIR}     &  BFNQG~\cite{BFNQG} &  Hybrid Model   & 0.93 $\pm$ 0.01 & 139 & 10.6 \\
% OSSE NADIR &  4DVarNet~\cite{4DVARNETSWOT} &  Bi-Level Opt.  & 0.95 $\pm$ 0.01 & 117 & 7.7 \\
% \bottomrule
% \end{tabular}}
% \end{table}



For the four data challenges presented in the previous section, we used \texttt{OceanBench} pipelines to deliver a ML-ready benchmarking framework.
We used the \texttt{hydra} and the geoprocessing tools outlined in section~\ref{sec:code_structure} with specialized routines for regridding the ocean satellite data to a uniformly gridded product and vice versa when necessary. 
Appendix~\ref{sec:hydra_recipes} showcases an example of the hydra integration for the preprocessing pipeline. 
A key feature is the creation of a custom patcher for the appropriate geophysical variables using our \texttt{XRPatcher} tool, which is later integrated into custom datasets and dataloaders for the appropriate model architecture, e.g., coordinate-based or grid-based. 
We provide an example snippet of how this can be done easily in section~\ref{sec:xrpatcher}.
\texttt{OceanBench} also features some tools specific to the analysis of SSH. 
For example, physically-interpretable variables like geostrophic currents and relative vorticity, which can be derived from first-order and second-order derivatives of the SSH, are essential for assessing the quality of the reconstructions generated by the models. 
Figure~\ref{fig:oceanbench_maps} showcases some fields of the most common physical variables used in the oceanography literature for the SSH-based analysis of sea surface dynamics.



% \include{content/appendix/fourdvarnet_maps}




%The \textit{Ocean-Data-Challenge} group has a wide-range of different OSSE and OSE experiments involving SSH interpolation in particular~\cite{DCOSEGULFSSH,DCOSSEGULFSSH}. 
%For this paper, we will focus on a subset and demonstrate some evaluation steps generated from the \texttt{OceanBench} framework.
%We outline an experimental setup SSH reconstruction over the Gulfstream with three OSSE's configurations and one OSE configuration in the next section. For more detailed information about the experimental setups for each configuration, see section~\ref{sec:data_challenges_extended} in the appendix.

% \begin{itemize}
%     \item 


%The observation data uses NADIR altimetry tracks which are very fine, thin ocean satellite observations (see Figure~\ref{fig:oceanbench_maps} (a) \& (b)). 





% \begin{itemize}
%     \item Experiment I (\textbf{OSSE NADIR}) addresses SSH interpolation using NADIR altimetry tracks which are very fine, thin ocean satellite observations (see Figure~\ref{fig:oceanbench_maps}). It relies on an OSSE using anocean simulations generated by the NEMO model, more precisely a high-resolution simulation, $1/60^\circ$ resolution, over one year with a whole field every day. 
% %The observation data uses NADIR altimetry tracks which are very fine, thin ocean satellite observations (see Figure~\ref{fig:oceanbench_maps} (a) \& (b)). 
% \item Experiment II (\textbf{OSSE SWOT}) addresses SSH interpolation using jointly NADIR and SWOT altimetry data. We complement the \textbf{OSSE NADIR} configuration with simulated SWOT observations.  
% SWOT is a new satellite altimetry mission with  much higher spatial coverage but a much lower temporal resolution as illustrated in Figure~\ref{fig:oceanbench_maps}.
% The higher spatial resolution allows us to see structures at a smaller resolution but at the cost of a massive influx of observations (over $\times 100$).
% \item Experiment III (\textbf{OSSE SST}) addresses SSH interpolation using 
% jointly altimetry and SST satellite data. We complement the \textbf{OSSE SWOT} challenge with simulated SST observations. 
% Satellite-derived SST observations are more abundantly available in natural operational settings than SSH at a finer resolution, and structures have visible similarities \cite{}.
% So this challenge allows for methods to take advantage of multi-modal learning \cite{}.
% \item Experiment IV \textbf{OSE NADIR} addresses SSH interpolation for real NADIR altimetry data. In contrast to the three OSSE data challenges, it only looks at actual observations aggregated from the currently available ocean altimetry data from actual satellites. It involves a similar space-time sampling as Experiment (\textbf{OSSE NADIR}) to evaluate the generalization of ML methods trained in Experiment I to real altimetry data. Besides, one may also explore learning or fine-tuning strategies from the available OSE dataset. We may point out that the complexity of the training problem due to the sparsity of refence dataset compared with \textbf{OSSE NADIR} dataset.
% \end{itemize}




Regarding the evaluation framework, we include domain-relevant performance metrics beyond the standard ML loss and accuracy functions. They account for the sampling patterns of the evaluation data. Spectral analytics are widely used in geoscience~\cite{BFNQG}, and here, we consider spectral scores computed as the minimum spatial and temporal scales resolved by the reconstruction methods proposed in~\cite{BFNQG}.
For example, figure~\ref{fig:oceanbench_psd} showcases how \texttt{OceanBench} generated the isotropic power spectrum and score and the space-time power spectrum decomposition and score.
Table~\ref{tb:expresults} outlines some standard and domain-specific scores for the experiments outlined in section~\ref{sec:experimental_design}.


% \begin{table}[h]
% \caption{This table highlights some of the results for the \textbf{OSSE NADIR} experiment outlined in section~\ref{sec:data_challenges} and appendix~\ref{sec:data_challenges_extended}.
% % and the OSE experiment outlined in section~\ref{sec:ose}~\tocite{}. 
% % For more results regarding the SWOT data, please see section~\ref{sec:other_tasks}. 
% This table highlights the performance statistically in the real and spectral space; the normalized RMSE for the real space and the minimum spatial and temporal scales resolved in the spectral domain. 
% For more information about the class of models displayed and class of metrics, see appendix~\ref{sec:ml_ontology} and appendix~\ref{sec:metrics} respectively. We only showcase the model performance on the alongtrack NADIR data available. For the extended table for each of the challenges, see Table~\ref{tb:exp-results-mega}.}
% \label{tb:oceanbench_results}
% \centering
% \begin{tabular}{lllcccc}
%  \toprule
% % Experiment & Configuration & Method & nRMSE & Resolved Scale [km]    \\ \midrule
% % \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
% % &  &   &  & Wavelength [km]  & Period [days]      \\ \midrule
% % \multirow{2}{*}{Experiment} & \multirow{2}{*}{Algorithm} & \multirow{2}{*}{Algorithm Class} & \multirow{2}{*}{nRMSE} & \multicolumn{2}{c}{Effective Resolution} \\ 
% Experiment &  Algorithm &   Algorithm Class &  nRMSE & $\lambda_{\mathbf{x}}$ [km]  & $\lambda_{t}$ [days]      \\ \midrule
% \multicolumn{1}{l}{OSSE NADIR}     &  OI (app.~\ref{sec:oi}) &  Coordinate-Based & 0.91 $\pm$ 0.01 & 176 & 11.6\\
% \multicolumn{1}{l}{OSSE NADIR}     &  MIOST~\ &  Coordinate-Based  & 0.92 $\pm$ 0.01 & 157 & 10.3 \\
% % \multicolumn{1}{l}{OSSE Gulf}     &  NerF &  Coordinate-Based  & 0.92 $\pm$ 0.01 & ... &\\
% \multicolumn{1}{l}{OSSE NADIR}     &  BFNQG (app.~\ref{sec:bfn}) &  Hybrid Model   & 0.92 $\pm$ 0.01 & 139 & 10.6 \\
% OSSE NADIR &  4DVarNet (app.~\ref{sec:4dvarnet}) &  Bi-Level Opt.  & 0.95 $\pm$ 0.01 & 117 & 7.7 \\
% % \bottomrule
% % OSE Gulf     &  OI &  Coordinate-Based  & ... & ... &\\
% % \multicolumn{1}{l}{OSE Gulf}     &  MIOST &  Coordinate-Based  & ... & ... &\\
% % \multicolumn{1}{l}{OSE Gulf}     &  NerF &  Coordinate-Based  & ... & ... &\\
% % \multicolumn{1}{l}{OSE Gulf}     &  BFNQG &  Hybrid Model  & ... & ... &\\
% % \multicolumn{1}{l}{OSE Gulf}     &  4DVarNet &  Bi-Level Opt.  & ... & ... &\\
% \bottomrule
% \end{tabular}
% \end{table}

